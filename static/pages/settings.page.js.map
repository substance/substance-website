{"version":3,"file":"settings.page.js","sources":["../../../src/PictureSelector.js","../../../src/ErrorMessage.js","../../../src/SuccessMessage.js","../../../src/Settings.js","../../../src/SettingsPage.js"],"sourcesContent":["import { Component, $$, Button } from 'substance'\nimport _sendRequest from './_sendRequest'\n\n/* global FormData */\n\nexport default class PictureSelector extends Component {\n  getInitialState () {\n    return {\n      value: this.props.image\n    }\n  }\n\n  render () {\n    const { value } = this.state\n    return $$('div').addClass('sc-picture-selector').append(\n      $$('div').addClass('se-badge-image').append(\n        $$('img', { src: value }).on('click', this.openFileUploadDialog),\n        $$('input', { className: 'se-file-upload', type: 'file', accept: 'image/*', ref: 'fileUpload' })\n          .on('change', this.onFileSelect)\n      ),\n      $$(Button, { size: 'small', style: 'primary' }, value ? 'Replace image' : 'Upload image')\n        .on('click', this.openFileUploadDialog)\n    )\n  }\n\n  onFileSelect (e) {\n    const files = e.currentTarget.files\n    this.uploadFile(files[0])\n  }\n\n  openFileUploadDialog (e) {\n    e.preventDefault()\n    this.refs.fileUpload.click()\n  }\n\n  val (value) {\n    if (value) {\n      this.setState({ value })\n    } else {\n      return this.state.value\n    }\n  }\n\n  uploadFile (file) {\n    const form = new FormData()\n    form.append('asset', file)\n    _sendRequest({\n      method: 'PUT',\n      url: '/api/uploadProfilePicture',\n      multiPart: true,\n      data: form\n    }).then(response => {\n      const data = JSON.parse(response)\n      const assets = data.assets\n      if (assets) {\n        this.val(assets[0])\n      }\n    }).catch(err => {\n      this.setState({ error: err.message })\n    })\n  }\n}\n","import { $$, Component } from 'substance'\n\nexport default class ErrorMessage extends Component {\n  render () {\n    return $$('div', { class: 'sc-error-message' }).append(this.props.children)\n  }\n}\n","import { $$, Component } from 'substance'\n\nexport default class SuccessMessage extends Component {\n  render () {\n    return $$('div', { class: 'sc-success-message' }).append(this.props.children)\n  }\n}\n","import { Component, $$, Button, HorizontalStack, Input, Form, FormRow } from 'substance'\nimport _sendRequest from './_sendRequest'\nimport PageDialog from './PageDialog'\nimport PictureSelector from './PictureSelector'\nimport ErrorMessage from './ErrorMessage'\nimport SuccessMessage from './SuccessMessage'\n\nexport default class Settings extends Component {\n  render () {\n    const { displayName, email, image, bio, website } = this.props.user\n    const formEl = $$(Form)\n\n    if (this.state.error) {\n      formEl.append(\n        $$(FormRow, {},\n          $$(ErrorMessage, {}, this.state.error)\n        )\n      )\n    } else if (this.state.success) {\n      formEl.append(\n        $$(FormRow, {},\n          $$(SuccessMessage, {}, 'Your settings succefully updated')\n        )\n      )\n    }\n\n    formEl.append(\n      $$(FormRow, { label: 'Profile picture' },\n        $$(PictureSelector, { image })\n      ),\n      $$(FormRow, { label: 'Your name' },\n        $$(Input, { ref: 'displayName', autofocus: true, value: displayName })\n      ),\n      $$(FormRow, { label: 'Email' },\n        $$(Input, { ref: 'email', value: email, type: 'email', disabled: true })\n      ),\n      $$(FormRow, { label: 'Bio' },\n        $$(Input, { ref: 'bio', value: bio })\n      ),\n      $$(FormRow, { label: 'Website' },\n        $$(Input, { ref: 'website', value: website })\n      ),\n      $$(HorizontalStack, {},\n        $$(Button, { style: 'primary', disabled: Boolean(this.state.saving) }, 'Update Profile')\n          .on('click', this.saveUserSettings),\n        $$(Button, { style: 'danger', size: 'small' }, 'Delete Account')\n          .on('click', this.deleteAccount)\n      )\n    )\n\n    return (\n      $$('div', { className: 'sc-settings' },\n        $$(PageDialog, { size: 'small', title: 'Account Settings' },\n          formEl\n        )\n      )\n    )\n  }\n\n  async deleteAccount () {\n    if (window.confirm('Are you really sure? You will not be able to bring your data back.')) {\n      console.info('TODO: implement account deletion.')\n    }\n  }\n\n  async saveUserSettings () {\n    const data = Object.keys(this.refs).reduce((data, ref) => {\n      data[ref] = this.refs[ref].val()\n      return data\n    }, {})\n\n    this.setState({\n      error: false,\n      success: false,\n      saving: true\n    })\n\n    const result = await _sendRequest({\n      method: 'POST',\n      url: '/api/updateUser',\n      json: true,\n      data\n    })\n    if (result.error) {\n      this.setState({\n        error: result.error,\n        saving: false\n      })\n    } else {\n      this.setState({\n        error: false,\n        success: true,\n        saving: false\n      })\n      this.extendProps({ user: result })\n    }\n  }\n}\n","import { $$ } from 'substance'\nimport BasePage from './BasePage'\nimport DashboardHeader from './DashboardHeader'\nimport MobileHeader from './MobileHeader'\nimport Footer from './Footer'\nimport Settings from './Settings'\n\nexport default class SettingsPage extends BasePage {\n  get title () { return 'Settings' }\n\n  renderBodyContent () {\n    const { user } = this.props\n    const { isMobile } = this.state\n    return [\n      isMobile\n        ? $$(MobileHeader, { user })\n        : $$(DashboardHeader, { user, profile: user }),\n      $$(Settings, { user }),\n      $$(Footer, { isMobile })\n    ]\n  }\n}\n"],"names":["_sendRequest"],"mappings":"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"}