{"version":3,"file":"new.page.js","sources":["../../../src/NewDocumentPage.js"],"sourcesContent":["import { $$, debounce, Component, Button, Input, Form, FormRow } from 'substance'\nimport BasePage from './BasePage'\nimport Footer from './Footer'\nimport _sendRequest from './_sendRequest'\nimport DashboardHeader from './DashboardHeader'\nimport PageDialog from './PageDialog'\nimport Strong from './Strong'\nimport Paragraph from './Paragraph'\n\nexport default class NewDocumentPage extends BasePage {\n  renderBodyContent () {\n    const { user } = this.props\n    return [\n      $$(DashboardHeader, { user }),\n      $$(NewDocument, { user }),\n      $$(Footer)\n    ]\n  }\n}\n\nclass NewDocument extends Component {\n  getInitialState () {\n    return {\n      valid: false\n    }\n  }\n\n  didMount () {\n    this._debouncedValidateDocumentName = debounce(this._validateDocumentName.bind(this), 500)\n  }\n\n  render () {\n    return $$('form', { class: 'sc-new-document', method: 'POST', action: '/api/createNewDocument' },\n      $$(PageDialog, { size: 'small', title: 'Create a new document', hint: 'Only you can access the document until a public version is created' },\n        $$(Form, {},\n          $$(FormRow, {},\n            $$(Paragraph, {},\n              'Take a moment to give your new document a ',\n              $$(Strong, {}, 'short name'),\n              '. It will be used to create a memorable URL that you can share.'\n            )\n          ),\n          $$(FormRow, { label: 'Document name', error: this.state.error },\n            $$(Input, { name: 'documentName', type: 'text', placeholder: 'short-and-memorable-document-name', autocomplete: 'off' })\n              .ref('input')\n              .on('input', this._onInput)\n          ),\n          $$(Button, { style: 'primary', disabled: !this.state.valid }, 'Create Document')\n        )\n      )\n    )\n  }\n\n  _onInput () {\n    // After each input consider state invalid\n    this.setState({ valid: false })\n    // ... until the doc has been validated again\n    this._debouncedValidateDocumentName()\n  }\n\n  async _validateDocumentName () {\n    const documentName = this.refs.input.val()\n    if (documentName) {\n      // TODO: we could add some convenience for json based requests\n      // i.e. set Content-Type header and parse result\n      const result = await _sendRequest({\n        method: 'POST',\n        url: '/api/checkDocumentName',\n        json: true,\n        data: {\n          documentName\n        }\n      })\n      if (result.wrongFormat) {\n        this.setState({\n          error: 'Use at least 3 characters and only a-z 0-9 - _'\n        })\n      } else if (result.documentExists) {\n        this.setState({\n          error: 'Document already exists'\n        })\n      } else {\n        this.setState({ valid: true })\n      }\n    }\n  }\n}\n"],"names":["_sendRequest"],"mappings":"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"}